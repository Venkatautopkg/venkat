<?xml version="1.0" encoding="UTF-8"?>
<BES xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="BES.xsd">
	<{{TypeTaskOrFixlet}}{{^TypeTaskOrFixlet}}Task{{/TypeTaskOrFixlet}}>
		<Title>Install/Update: 7Zip v{{version}} - Windows (x64)</Title>
		<Description><![CDATA[This task will download and install "7Zip v{{version}}" package onto selected endpoints <br><br><b>Installation Command:</b> msiexec.exe /i {{file_name}} /qn /norestart<br><br><b>Run Command As:</b> System User<br><br><b>Download Size:</b> {{DownloadSize}} KB]]></Description>
		<Relevance>windows of operating system</Relevance>
		<Relevance><![CDATA[x64 of operating system]]></Relevance>
		<Relevance><![CDATA[(exists key whose (value "DisplayName" of it as string as lowercase contains "7-zip" AND (if exists value "DisplayVersion" of it then value "DisplayVersion" of it as string as version else maximum of (matches (regex "([0-9]+\.[0-9]+)") of (value "DisplayName" of it as string) as version)) < "{{version}}") of keys "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall" of ((x64 registries; x32 registries))) OR (not exists key whose (value "DisplayName" of it as string as lowercase contains "7-zip") of keys "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall" of ((x64 registries; x32 registries)))]]></Relevance>
		<Category></Category>
		<DownloadSize>{{DownloadSize}}{{^DownloadSize}}0{{/DownloadSize}}</DownloadSize>
		<Source>https://github.com/bigfix/bigfix-recipes</Source>
		<SourceID>Internal</SourceID>
		<SourceReleaseDate>{{SourceReleaseDate}}</SourceReleaseDate>
		<SourceSeverity></SourceSeverity>
		<CVENames></CVENames>
		<SANSID></SANSID>
		<MIMEField>
			<Name>x-fixlet-modification-time</Name>
			<Value>{{x-fixlet-modification-time}}</Value>
		</MIMEField>
		<Domain>BESC</Domain>
		<DefaultAction ID="Action1">
			<Description>
				<PreLink>Click </PreLink>
				<Link>here</Link>
				<PostLink> to deploy 7Zip v{{version}}.</PostLink>
			</Description>
			<ActionScript MIMEType="application/x-Fixlet-Windows-Shell">
// Download:
{{{prefetch}}}

// Is 7-zip open? Pause.
pause while {exists process "7zFM.exe"}

// Remove the 64-bit EXE version
if {exists file "C:\Program Files (x86)\7-Zip\Uninstall.exe"}
    waithidden "C:\Program Files (x86)\7-Zip\Uninstall.exe" /S
endif

// Remove old 64-bit MSI versions
if {exists file "C:\Program Files\7-Zip\Uninstall.exe"}
    waithidden "C:\Program Files\7-Zip\Uninstall.exe" /S
endif

// Install:
waithidden msiexec.exe /i __Download\{{{file_name}}} /qn /norestart
</ActionScript>
		</DefaultAction>
	</{{TypeTaskOrFixlet}}{{^TypeTaskOrFixlet}}Task{{/TypeTaskOrFixlet}}>
</BES>
